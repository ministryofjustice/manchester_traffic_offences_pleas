{% extends "plea/base.html" %}

{% load debug %}
{% load i18n %}

{% block page_title %}{{ block.super }} Your plea{% endblock %}

{% block page_content %}

    {% with request.session.case.number_of_charges as charges %}
<form action="{{ request.path }}" method="post" autocomplete="off" novalidate>

    {% csrf_token %}

    {% if formset_has_errors %}
    <section class="error-summary">
        <h2>{% trans "You need to fix the errors on this page before continuing." %}</h2>
        
        <p>{% trans "See highlighted errors below." %}</p>
        
        <ul>
        {% with forms.0 as formset %}
            {% for form in formset %}
                {% for field in form %}
                    {% if field.errors %}
            <li><a href="#section_{{ field.name }}_{{ forloop.parentloop.counter }}">{{ field.errors|striptags }}</a></li>
                    {% endif %}
                {% endfor %}
            {% endfor %}
        {% endwith %}
        </ul>
    </section>
    {% endif %}

    <header class="content-header">
        <h1>{% blocktrans count charges=charges %}Your plea{% plural %}Your pleas{% endblocktrans %}</h1>

        <p>{% trans "This is your opportunity to present your case to the court." %}</p>
    </header>

    {% with formset=forms.0 form_count=forms.0|length %}

        {{ formset.management_form }}

        <h2 class="heading-medium">{% blocktrans with form_count=form_count count charges=charges %}Enter a plea for the charge below{% plural %}Enter {{ form_count }} pleas for the charges below{% endblocktrans %}</h2>

        {% for form in formset %}
        <section id="section_guilty_{{ forloop.counter }}">
            
            <div class="form-group-wide{% if form.guilty.errors %} with-error{% endif %}" id="section_guilty_{{ forloop.counter }}">
              <fieldset>
                {% if form_count > 1 or form.guilty.errors %}
                <legend class="form-label">
                    {% if form_count > 1 %}
                    {% blocktrans with counter=forloop.counter %}Your plea for charge [{{ counter }}]{% endblocktrans %}
                    {% endif %}

                    {{ form.guilty.errors }}
                </legend>
                {% endif %}

                <div class="form-field">
                    <div class="inline">

                        {% for choice in form.guilty %}
                        <label for="id_{{ choice.name }}_{{ choice.choice_value }}" class="block-label">
                            <input id="id_{{ choice.name }}_{{ choice.choice_value }}" type="radio" name="{{ choice.name }}" value="{{ choice.choice_value }}" {% if choice.is_checked %}checked="checked"{% endif %}>
                            {{ choice.choice_label }}
                        </label>
                        {% endfor %}
                      
                    </div>
                </div>
              </fieldset>
            </div>

            <ul class="js-hidden go-to">
                <li>{% blocktrans with field_id=form.guilty.0.name %}If you answered <em>Guilty</em>, you can enter <a href="#{{ field_id }}_guilty_extra">special circumstances</a>{% endblocktrans %}</li>
                <li>{% blocktrans with field_id=form.guilty.0.name %}If you answered <em>Not Guilty</em>, you can tell us <a href="#{{ field_id }}_not_guilty_extra">why you believe you are not guilty</a>{% endblocktrans %}</li>
            </ul>

            <div class="panel-indent move-up" data-conditional-trigger="{{ form.prefix }}-guilty" data-conditional-value="^(guilty|not_guilty)$">

                <section id="{{ form.guilty.0.name }}_guilty_extra" class="js-Conditional js-hidden" data-conditional-trigger="{{ form.prefix }}-guilty" data-conditional-value="^guilty$">

                    {% with form.guilty_extra as field %}
                        {% include "widgets/std_field.html" %}
                    {% endwith %}

                </section>

                <section id="{{ form.guilty.0.name }}_not_guilty_extra" class="js-Conditional js-hidden" data-conditional-trigger="{{ form.prefix }}-guilty" data-conditional-value="^not_guilty$">

                    {% with form.not_guilty_extra as field %}
                        {% include "widgets/std_field.html" %}
                    {% endwith %}

                </section>
            </div>

        </section>


        {% endfor %}

    {% endwith %}

    <div class="form-submit">
        <button class="button" type="submit">{% trans "Continue" %}</button>
    </div>
</form>
    {% endwith %}
{% endblock page_content %}
