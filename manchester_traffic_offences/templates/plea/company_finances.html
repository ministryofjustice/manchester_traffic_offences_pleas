{% extends "plea/base.html" %}

{% load debug %}
{% load i18n %}
{% load form_widgets %}
{% load testing %}

{% block page_title %}
    {% if company_finances.nojs != "nojs_last_step" %}
        {% blocktrans %}Company details{% endblocktrans %}
    {% else %}
        {% blocktrans %}Company details continued{% endblocktrans %}
    {% endif %}
     - {{ block.super }}
{% endblock %}

{% block page_content %}

    {% with request.session.case.number_of_charges as charges %}
<form action="{{ request.path }}" method="post" autocomplete="off" novalidate>
    
    {% csrf_token %}

    {% no_js form %}

    {% if form.errors %}
    <section class="error-summary">
        <h2>{% trans "You need to fix the errors on this page before continuing." %}</h2>

        <p>{% trans "See highlighted errors below." %}</p>

        <ul>
        {% for field in form %}
            {% if field.errors %}
            <li><a href="#section_{{ field.name }}">{{ field.errors|striptags }}</a></li>
            {% endif %}
        {% endfor %}
        </ul>
    </section>
    {% endif %}

     <header class="content-header">
        <h1>
        {% if company_finances.nojs != "nojs_last_step" %}
            {% blocktrans %}Company details{% endblocktrans %}
        {% else %}
            {% blocktrans %}Company details continued{% endblocktrans %}
        {% endif %}
        </h1>

        <p>{% trans "The court will decide the company's fine based on its size and financial situation." %}</p>
    </header>

    {% if company_finances.nojs == "nojs_last_step" %}
    {% add_test_tag "<<NOJSTRIGGERSUMMARY>>" %}
    <div class="nojs-hidden">
        {% radio_field form.trading_period %}
    </div>
    <div class="form-header js-hidden">
        <h3><span>You selected:</span>
            {% if form.trading_period.value == "True" %}
            The company has been trading for more than 12 months
            {% else %}
            The company has been trading for less than 12 months
            {% endif %}
        </h3>
        <a href="{{ request.path }}?reset">Change</a>
    </div>
    {% else %}
    {% radio_field form.trading_period %}
    {% endif %}

    <div class="js-Conditional{% if company_finances.nojs != "nojs_last_step" %} nojs-hidden{% endif %}" data-conditional-trigger="trading_period" data-conditional-value="^(True|False)$">

        {% std_field form.number_of_employees hide_optional=True %}

        {% if company_finances.nojs == "nojs_last_step" %}
            {% if form.trading_period.value == "True" %}
                <p>{% blocktrans %}From the most recent audited company accounts, tell us:{% endblocktrans %}</p>
            {% else %}
                <p>{% blocktrans %}From the first 12 months' trading projections, tell us:{% endblocktrans %}</p>
            {% endif %}
        {% else %}
        <h3 class="heading-medium js-TemplatedElement" data-template-trigger="trading_period" data-template="{% blocktrans %}From the first 12 months' trading projections, tell us:{% endblocktrans %}" data-template-defaults-for="{% trans "Yes" %}">{% blocktrans %}From the most recent audited company accounts, tell us:{% endblocktrans %}</h3>
        {% endif %}

        {% money_field form.gross_turnover hide_optional=True %}

        {% money_field form.net_turnover hide_optional=True %}

    </div>

    {% endwith %}

    <div class="form-submit">
        <button class="button" type="submit">{% trans "Continue" %}</button>
    </div>
</form>

{% endblock page_content %}
